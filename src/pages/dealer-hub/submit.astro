---
import DealerHubLayout from '../../layouts/DealerHubLayout.astro';
---
<DealerHubLayout title="Submit a Request | Pinnacle Sales Dealer Hub" activeSection="Submit Request">

<h1>Submit a Request</h1>
<p class="page-subtitle">Send us a design for review, an order to check before submission, or request a Zoom training session for your team.</p>

<form id="request-form" class="request-form" name="dealer-request" method="POST" data-netlify="true" netlify-honeypot="bot-field" enctype="multipart/form-data">
  <input type="hidden" name="form-name" value="dealer-request" />
  <p hidden><label>Don't fill this out: <input name="bot-field" /></label></p>

  <div class="field">
    <label for="request-type">What do you need?</label>
    <div class="radio-group">
      <label class="radio-card">
        <input type="radio" name="request-type" value="design-review" required />
        <span class="radio-content">
          <span class="radio-icon">üìê</span>
          <span class="radio-label">Design Review</span>
          <span class="radio-desc">Have Pinnacle Sales review your 20/20 / ProKitchen design for accuracy, optimization, and specification errors. Available anytime ‚Äî use this whenever you want a second set of eyes on a project.</span>
        </span>
      </label>
      <label class="radio-card">
        <input type="radio" name="request-type" value="order-check" />
        <span class="radio-content">
          <span class="radio-icon">‚úÖ</span>
          <span class="radio-label">Pre-Order Check</span>
          <span class="radio-desc">Required for your first 3-4 projects. Submit your finalized order for review before placing with WW Wood. We catch spec errors, pricing issues, and lead-time surprises. After your first few projects, you're cleared to order independently.</span>
        </span>
      </label>
      <label class="radio-card">
        <input type="radio" name="request-type" value="zoom-training" />
        <span class="radio-content">
          <span class="radio-icon">üé•</span>
          <span class="radio-label">Zoom Training Session</span>
          <span class="radio-desc">Schedule a live training session for your team ‚Äî product knowledge, 20/20 / ProKitchen software, or any topic you need.</span>
        </span>
      </label>
    </div>
  </div>

  <!-- Shared fields -->
  <div class="field-row">
    <div class="field">
      <label for="dealer-company">Dealership Name</label>
      <input type="text" id="dealer-company" name="dealer-company" required placeholder="e.g. Castle Vision Design" />
    </div>
    <div class="field">
      <label for="contact-name">Your Name</label>
      <input type="text" id="contact-name" name="contact-name" required placeholder="First & last name" />
    </div>
  </div>

  <div class="field-row">
    <div class="field">
      <label for="contact-email">Email</label>
      <input type="email" id="contact-email" name="contact-email" required placeholder="you@company.com" />
    </div>
    <div class="field">
      <label for="contact-phone">Phone (optional)</label>
      <input type="tel" id="contact-phone" name="contact-phone" placeholder="480-555-1234" />
    </div>
  </div>

  <!-- Design Review / Order Check fields -->
  <div id="design-fields" class="conditional-section" style="display:none;">
    <div class="field-row">
      <div class="field">
        <label for="brand-select">Brand</label>
        <select id="brand-select" name="brand">
          <option value="">Select brand‚Ä¶</option>
          <option value="shiloh">Shiloh Cabinetry</option>
          <option value="eclipse">Eclipse Cabinetry</option>
          <option value="aspect">Aspect Cabinetry</option>
          <option value="nevara">Nevara Cabinetry</option>
          <option value="multi">Multiple Brands</option>
        </select>
      </div>
      <div class="field">
        <label for="project-name">Project / Client Name</label>
        <input type="text" id="project-name" name="project-name" placeholder="e.g. Smith Kitchen Remodel" />
      </div>
    </div>

    <div class="field">
      <label for="file-upload">Attach Project Files</label>
      <div class="file-upload-area" id="file-upload-area">
        <input type="file" id="file-upload" name="files" multiple accept=".2020,.mcd,.xml,.pdf,.dwg,.dxf,.jpg,.jpeg,.png,.zip" />
        <p class="file-hint">20/20 / ProKitchen files, PDFs, drawings, or images. Max 10MB total.</p>
        <p class="file-list" id="file-list"></p>
      </div>
    </div>

    <div class="field" id="urgency-field">
      <label>Timeline</label>
      <div class="pill-group">
        <label class="pill"><input type="radio" name="urgency" value="standard" checked /><span>Standard (2-3 days)</span></label>
        <label class="pill"><input type="radio" name="urgency" value="priority" /><span>Priority (24 hours)</span></label>
        <label class="pill"><input type="radio" name="urgency" value="rush" /><span>Rush (same day)</span></label>
      </div>
    </div>
  </div>

  <!-- Zoom Training fields -->
  <div id="training-fields" class="conditional-section" style="display:none;">
    <div class="field">
      <label for="training-topics">Training Topics</label>
      <div class="checkbox-group">
        <label class="checkbox-item"><input type="checkbox" name="topics" value="product-knowledge" /><span>Product Knowledge (Shiloh / Eclipse / Aspect)</span></label>
        <label class="checkbox-item"><input type="checkbox" name="topics" value="2020-prokitchen" /><span>20/20 / ProKitchen Software Training</span></label>
        <label class="checkbox-item"><input type="checkbox" name="topics" value="inset" /><span>Inset Cabinetry Masterclass</span></label>
        <label class="checkbox-item"><input type="checkbox" name="topics" value="competitive" /><span>Competitive Positioning</span></label>
        <label class="checkbox-item"><input type="checkbox" name="topics" value="custom-paint" /><span>Custom Paint Program</span></label>
        <label class="checkbox-item"><input type="checkbox" name="topics" value="other" /><span>Other (describe below)</span></label>
      </div>
    </div>

    <div class="field-row">
      <div class="field">
        <label for="team-size">How many attendees?</label>
        <select id="team-size" name="team-size">
          <option value="1-2">1-2 people</option>
          <option value="3-5">3-5 people</option>
          <option value="6-10">6-10 people</option>
          <option value="10+">10+ people</option>
        </select>
      </div>
      <div class="field">
        <label for="preferred-date">Preferred Date/Time</label>
        <input type="text" id="preferred-date" name="preferred-date" placeholder="e.g. Next Tuesday afternoon" />
      </div>
    </div>
  </div>

  <!-- Notes ‚Äî always visible -->
  <div class="field">
    <label for="notes">Additional Notes</label>
    <textarea id="notes" name="notes" rows="4" placeholder="Anything specific you'd like us to focus on, questions, or context that would help‚Ä¶"></textarea>
  </div>

  <button type="submit" class="submit-btn" id="submit-btn">Submit Request</button>
</form>

<!-- Success message -->
<div id="success-message" class="success-message" style="display:none;">
  <div class="success-icon">‚úì</div>
  <h2>Request Submitted</h2>
  <p>Your request has been submitted to the Pinnacle Sales team along with any attached files. We'll respond within the timeline indicated.</p>
  <p style="color:var(--color-muted);font-size:0.88rem;">If you don't hear back, contact us directly at 480-993-9224 or <a href="mailto:marketing@pinnaclesales.biz">marketing@pinnaclesales.biz</a>.</p>
  <a href="/dealer-hub/dashboard" class="back-link">‚Üê Back to Dashboard</a>
</div>

<script is:inline>
  // Show/hide conditional fields based on request type
  document.querySelectorAll('input[name="request-type"]').forEach(function(radio) {
    radio.addEventListener('change', function() {
      var designFields = document.getElementById('design-fields');
      var trainingFields = document.getElementById('training-fields');
      if (this.value === 'zoom-training') {
        designFields.style.display = 'none';
        trainingFields.style.display = 'block';
      } else {
        designFields.style.display = 'block';
        trainingFields.style.display = 'none';
      }
    });
  });

  // File upload display
  document.getElementById('file-upload').addEventListener('change', function() {
    var list = document.getElementById('file-list');
    if (this.files.length > 0) {
      var names = Array.from(this.files).map(function(f) {
        return f.name + ' (' + (f.size / 1024 / 1024).toFixed(1) + 'MB)';
      });
      list.textContent = names.join(', ');
    } else {
      list.textContent = '';
    }
  });

  // Form submission via Netlify Forms
  document.getElementById('request-form').addEventListener('submit', function(e) {
    e.preventDefault();

    var btn = document.getElementById('submit-btn');
    btn.disabled = true;
    btn.textContent = 'Sending‚Ä¶';

    var form = this;
    var formData = new FormData(form);

    fetch('/', {
      method: 'POST',
      body: formData
    })
    .then(function(response) {
      if (response.ok) {
        form.style.display = 'none';
        document.getElementById('success-message').style.display = 'block';
        window.scrollTo(0, 0);
      } else {
        throw new Error('Submission failed');
      }
    })
    .catch(function(error) {
      btn.disabled = false;
      btn.textContent = 'Submit Request';
      alert('Something went wrong. Please try again or email marketing@pinnaclesales.biz directly.');
    });
  });
</script>

</DealerHubLayout>

<style>
  .request-form { max-width: 720px; }
  .field { margin-bottom: 1.25rem; }
  .field label {
    display: block; font-size: 0.85rem; font-weight: 600;
    color: var(--color-dark); margin-bottom: 0.4rem; letter-spacing: 0.02em;
  }
  .field input[type="text"],
  .field input[type="email"],
  .field input[type="tel"],
  .field select,
  .field textarea {
    width: 100%; padding: 0.65rem 0.85rem;
    border: 1px solid var(--color-border); border-radius: 4px;
    font-size: 0.95rem; font-family: var(--font-body);
    transition: border-color 0.15s; background: #fff;
  }
  .field input:focus, .field select:focus, .field textarea:focus {
    outline: none; border-color: var(--color-dark);
  }
  .field textarea { resize: vertical; }
  .field-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  @media (max-width: 600px) { .field-row { grid-template-columns: 1fr; } }

  /* Radio cards for request type */
  .radio-group { display: flex; flex-direction: column; gap: 0.75rem; }
  .radio-card { cursor: pointer; display: block; }
  .radio-card input { display: none; }
  .radio-content {
    display: block; border: 1px solid var(--color-border); border-radius: 6px;
    padding: 1.25rem; transition: all 0.15s;
  }
  .radio-card input:checked + .radio-content {
    border-color: var(--color-dark); background: rgba(0,0,0,0.02);
    box-shadow: 0 0 0 1px var(--color-dark);
  }
  .radio-icon { font-size: 1.25rem; display: block; margin-bottom: 0.4rem; }
  .radio-label { font-weight: 600; font-size: 1rem; color: var(--color-black); display: block; margin-bottom: 0.25rem; }
  .radio-desc { font-size: 0.85rem; color: var(--color-muted); line-height: 1.5; }

  /* Conditional sections */
  .conditional-section {
    border-top: 1px solid var(--color-border);
    padding-top: 1.5rem; margin-top: 0.5rem;
  }

  /* File upload */
  .file-upload-area {
    border: 2px dashed var(--color-border); border-radius: 6px;
    padding: 1.25rem; text-align: center; position: relative;
  }
  .file-upload-area input[type="file"] {
    position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
  }
  .file-hint { font-size: 0.85rem; color: var(--color-muted); margin: 0; }
  .file-list { font-size: 0.82rem; color: var(--color-dark); margin: 0.5rem 0 0; word-break: break-all; }

  /* Pills for urgency */
  .pill-group { display: flex; gap: 0.5rem; flex-wrap: wrap; }
  .pill { cursor: pointer; }
  .pill input { display: none; }
  .pill span {
    display: inline-block; padding: 0.4rem 1rem;
    border: 1px solid var(--color-border); border-radius: 20px;
    font-size: 0.85rem; color: var(--color-muted); transition: all 0.15s;
  }
  .pill input:checked + span {
    border-color: var(--color-dark); background: var(--color-dark); color: #fff;
  }

  /* Checkbox group */
  .checkbox-group { display: flex; flex-direction: column; gap: 0.5rem; }
  .checkbox-item {
    display: flex; align-items: center; gap: 0.5rem;
    font-size: 0.92rem; cursor: pointer;
  }
  .checkbox-item input { width: 16px; height: 16px; accent-color: var(--color-dark); }

  /* Submit */
  .submit-btn {
    width: 100%; padding: 0.8rem; margin-top: 0.5rem;
    background: var(--color-dark); color: #fff; border: none; border-radius: 4px;
    font-size: 1rem; font-family: var(--font-body); cursor: pointer; transition: background 0.15s;
  }
  .submit-btn:hover { background: #000; }
  .submit-btn:disabled { background: #999; cursor: not-allowed; }

  /* Success */
  .success-message { text-align: center; padding: 3rem 0; }
  .success-icon {
    width: 60px; height: 60px; margin: 0 auto 1.5rem;
    background: var(--color-dark); color: #fff; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.5rem;
  }
  .success-message h2 { margin-bottom: 0.75rem; }
  .back-link {
    display: inline-block; margin-top: 1.5rem; font-size: 0.9rem;
    color: var(--color-dark); text-decoration: underline; text-underline-offset: 3px;
  }
</style>
